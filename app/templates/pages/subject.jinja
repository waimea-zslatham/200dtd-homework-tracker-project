{#=====================================================
  Thing page
  - Shows details of a single thing
  - Has a delete link to remove it
=====================================================#}

{% extends 'pages/base.jinja' %}


{% block title %}

    Homework for {{ subject.name }}

{% endblock %}


{% block content %}

    <h1>Homework for {{ subject.name }}</h1>


    <article>

            <ul class="assessment-list">
                {% for assessment in assessments %}
        <li>
            <span class="priority">{{ assessment.priority }}</span>

            <span class="assessment-info">
                {{ assessment.name }} ‚Äî <small>{{ assessment.due_date }}</small>
            </span>

            {% if assessment.completed == 1 %}
                <form class="action-button" method="post" action="/subject/{{ subject.id }}/assessment/{{ assessment.id }}/not.done">
                    <button title="Mark not done">üóπ</button>
                </form>
            {% else %}
                <form class="action-button" method="post" action="/subject/{{ subject.id }}/assessment/{{ assessment.id }}/done">
                    <button title="Mark done">‚òê</button>
                </form>
            {% endif %}

            <a href="/subject/{{ subject.id }}/delete/assessment/{{ assessment.id }}" 
               class="delete-button"
               style="color:red;"
               onclick="return confirm('Are you sure you want to delete {{ assessment.name }}?');">
               üóë
            </a>
        </li>
    {% else %}
        <p>None!</p>
    {% endfor %}
</ul>

    </article>

    <article>

        <details>
            <summary>
                +    
            </summary>

            <h3>Add a New Assessment</h3>
            <form action="/subject/{{ subject.id }}/add/assessment" method="POST">

                <input
                    type="text"
                    name="assessment"
                    placeholder="Name of Assessment"
                    required
                >

                <input
                    type="number"
                    name="priority"
                    min="0"
                    max="5"
                    placeholder="Priority of Assessment"
                    required
                >

                <input
                    type="date"
                    name="date"
                    required
                >

                <button>Add the Assessment</button>
            </form>

        </details>


    </article>


    <a role="button" href="/">Back to Subjects</a>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const subjectName = "{{ subject.name }}";
  const forms = document.querySelectorAll(".action-button");

  // Make sure we have a stored list for this subject
  let stored = JSON.parse(localStorage.getItem("homeworkProgress")) || {};
  if (!stored[subjectName]) {
    stored[subjectName] = {};
  }

  forms.forEach(form => {
    form.addEventListener("submit", () => {
      const action = form.action;
      const isDone = action.includes("/done");
      const assessmentName = form.parentElement.querySelector(".assessment-info").textContent.trim();

      stored[subjectName][assessmentName] = isDone;
      localStorage.setItem("homeworkProgress", JSON.stringify(stored));
    });
  });
});
</script>


{% endblock %}

